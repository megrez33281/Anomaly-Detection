# Anomaly Detection Project - 實作日誌

這份文件記錄了 HW2: Anomaly Detection 專案的整個實作流程、決策和思考過程。

## 階段一：數據探索與基準建立 (2025-10-08)

1.  **目標**：理解數據集結構，並建立一個可以運行的基礎模型管線 (pipeline)。
2.  **數據探索**：
    *   使用 `list_directory` 工具檢查 `Dataset` 資料夾。
    *   發現數據集結構為 `Dataset/Dataset/`，且 `train` 和 `test` 資料夾內的圖片是混合所有類別的扁平結構，而非按類別分子資料夾。
    *   此結構意味著模型必須學習一個通用的「正常」表示，而不是針對特定類別。
3.  **建立 `main.py`**：
    *   創建專案主腳本 `main.py`。
    *   **程式碼結構**：
        *   `Config` 類別：集中管理所有超參數和路徑，方便調整。
        *   `set_seed()` 函數：確保實驗的可重現性。
        *   `AnomalyDataset` 類別：自定義的 PyTorch Dataset，用於讀取扁平結構的圖像資料。
        *   `UNetAutoencoder` 類別：實現計畫中的 U-Net 型自編碼器架構，包含編碼器、解碼器以及跳接。
        *   主執行區塊 (`if __name__ == "__main__":`)：搭建了數據載入、模型初始化、優化器設定，以及一個用於測試管線是否通暢的**虛擬訓練迴圈**。

## 階段二：模型診斷與數據增強 (2025-10-08)

1.  **問題分析**：
    *   執行了初步的訓練流程，發現雖然訓練損失 (Train Loss) 能正常下降，但驗證集上的 AUROC 分數始終在 0.5 左右，表示模型完全沒有學到區分正常與異常樣本的能力。
    *   **診斷**：這是一個典型現象，說明模型學到了一個「捷徑」。由於訓練數據過於單一（固定的尺寸和視角），模型只需學會重建一個「模糊的平均影像」就能降低損失，而無需學習圖像真正的、細粒度的紋理特徵。因此，當面對紋理錯位的 `CutPaste` 樣本時，其重建誤差與正常樣本沒有顯著差異。

2.  **解決方案**：
    *   **數據增強**：為了迫使模型學習更具泛化能力的紋理特徵，我們採納了計畫書中的策略，在訓練階段引入了數據增強。
    *   **具體實作**：修改了 `main.py` 中的 `train_transform`，將原本固定的 `Resize` 替換為 `transforms.RandomResizedCrop`。這會讓模型在每次訓練時都看到不同縮放、不同裁剪位置的圖像，從而無法再依賴簡單的低頻資訊作弊，必須學習到更本質的特徵。
    *   同時，將 `Config.EPOCHS` 增加到 30，給模型更長的學習時間來適應這個更困難的任務。
